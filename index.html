<!doctype html>
<html>
<head>
<meta charset="utf-8">
    
<link href="css/animate.css" rel="stylesheet" type="text/css">
<link href="css/materialize.css" rel="stylesheet" type="text/css">
<link href="css/main.css" rel="stylesheet" type="text/css">
    
<script src="js/map.js"></script>

<script src="js/jquery.min.js"></script>
<script src="cordova.js"></script>
<script src="js/materialize.js"></script>
<script src="js/preventreload.js"></script>
<script src="js/main.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

<script type="text/javascript">
    
document.addEventListener("deviceready", onDeviceReady, false);

function onDeviceReady() {
screen.lockOrientation('portrait');
}

$(document).ready(function() {
    
$.get( "http://250taxi.com/db/partner/check_app_update.php?check=driver",  function( data ) {
    var currentversion = "1";
    var serverversion = data;
    if (currentversion < serverversion) {
        alert("Your app is outdated. Please install the update from google play.");
        window.open('http://250taxi.com/getupdate/driver.php', '_system');
    }
});
    
    $('select').material_select();
});

</script>
    
<script>
document.addEventListener("deviceready", onDeviceReady, false);
function onDeviceReady() {
    screen.lockOrientation('portrait');
    document.addEventListener("backbutton", function (e) {
        e.preventDefault();
    }, false );
}
</script>

</head>

<body id="body">
    
<div id="view_start">
<img id="logo" src="icon.png">
<br><br>
<a id="login_btn" class="waves-effect waves-light btn taxi250">Partner-Login</a>
<br><br>
<a id="login_btn_register" class="waves-effect waves-light btn taxi250">Register</a>
<br><br>
<a id="login_admin_btn" class="waves-effect waves-light btn white grey-text">Admin-Login</a>
</div>
    
<div id="view_login">
    
<form id="login_form" action="javascript:login_form_go();" class="col s12">
    
<div class="row">
      <div class="col s12 m5">
        <div class="card-panel white">
          
<div class="input-field col s12">
    <select id="partner_type" required="" aria-required="true">
      <option value="" disabled selected>Choose partner type</option>
      <option value="TX_">Taxi</option>
      <option value="CR_">Courier</option>
      <option value="MO_">Moto</option>
    </select>
</div>
            
<div class="input-field col s12">
          <input id="id_no" type="text" required="" aria-required="true" class="validate">
          <label for="id_no">ID No.</label>
</div>
            
<div class="input-field col s12">
          <input id="pin" type="number" required="" aria-required="true" maxlength = "4" pattern=".{4,}" class="validate">
          <label for="pin">PIN</label>
</div>
    
<a id="login_btn_go" class="waves-effect waves-light btn taxi250">Login</a>
            
        </div>
      </div>
    </div>
    
    </form>
    
<div class="row">
      <div class="col s12 m5">
        <div class="card-panel white">
        <img id="scan_qr" src="img/scan_qr.png">
          <a id="login_btn_go" class="waves-effect waves-light btn taxi250" onclick="scancode();">Scan QR-Code</a>  
        </div>
      </div>
    </div>
    
</div>
    
<div id="view_taxi_waiting" style="display:none;">
    
<style>
#radar, #radar_offline {
    background-color: black;
    width: 100%;
    color: white;
}
.infobox {
    background-image: url(img/information-outline.svg);
    background-repeat: no-repeat;
    background-size: auto 80%;
    background-position: 3% center;
    padding-left: 60px;
    padding-top: 5px;
    padding-bottom: 5px;
    text-align: left;
    background-color: white;
}
</style>
    
    <div id="radar"><br>
    <img src="img/220.gif" style="width:60%;"><br>
        Waiting for passengers...<br>You are visible!<br><br>
    </div>
    
    <div id="radar_offline" style="display:none;"><br>
    <img src="img/offline.png" style="width:60%;"><br>
        You have gone offline.<br>Passengers can't find you!<br><br>
    </div>
    
    <div class="infobox">
    The app has to stay open for best performance.
    </div>
    
    <br><br>

<script>
    $(document).ready(function() {
        
    
        
        $( "#toggle_online_checkbox").prop('checked', true);
        localStorage.setItem("status", "online");
        
        $( "#toggle_online" ).click(function() {
        var toggle_online_checkedValue = document.getElementById('toggle_online_checkbox').checked;
        localStorage.setItem("toggle_online",toggle_online_checkedValue);
        set_online_status();
        });
    });
    
    function set_online_status() {
        var toggle_online = localStorage.getItem("toggle_online");
        // alert(toggle_online);
        if (toggle_online == "false") {
            document.getElementById("radar_offline").style.display = "block";
            document.getElementById("radar").style.display = "none";
            localStorage.setItem("status", "offline");
        }
        if (toggle_online == "true") {
            document.getElementById("radar_offline").style.display = "none";
            document.getElementById("radar").style.display = "block";
            localStorage.setItem("status", "online");
        }
            
    }
    

    
function getLocationUpdate(){
navigator.geolocation.getCurrentPosition(showPosition);
}
    
function showPosition(position) {
    latitude = position.coords.latitude;
    longitude = position.coords.longitude;
    console.log(latitude);
    console.log(longitude);
    
    status = localStorage.getItem("status");
    
    var loggedin = localStorage.getItem('loggedin');
    
    if (loggedin == 'Yes') {
        id_no = localStorage.getItem("id_no");
    }

    $.get( "http://250taxi.com/db/partner/taxi_comlink.php?id_no="+id_no+"&status="+status+"&latitude="+latitude+"&longitude="+longitude+"", function( data ) {
        
// console.log(data);

var d1 = data.substring(0,1);
// var d2 = data.substring(3,4);
// var d3 = data.substring(4,5);
// var d4 = data.substring(5);
        
// console.log("d1: "+d1+" d2: "+d2+" d3: "+d3+" d4: "+d4+"");
console.log("d1: "+d1+"");
        
// No passenger request - Show waiting screen
if (d1 == "0") {
    $( "#view_taxi_waiting" ).fadeIn( "slow", function() {
        $( "#view_taxi_journeyrequest" ).fadeOut( "slow", function() {
            document.getElementById("journeyrequest_passenger_cards").className = "row";
        });
  });
}

// Passenger has requested journey - Get details and show options
if (d1 == "1") {
    $( "#view_taxi_waiting" ).fadeOut( "slow", function() {
    $( "#view_taxi_journeyrequest" ).fadeIn();
    document.getElementById("journeyrequest_passenger_cards").className = "row animated zoomIn";
    });
    
    $.get( "http://250taxi.com/db/partner/taxi_comlink_passenger_details.php?task=getpassengername&id_no="+id_no+"",  function( data ) {
        
journeyrequest_passenger_name = data;

document.getElementById("journeyrequest_passenger_name").innerHTML = journeyrequest_passenger_name;
        
var passenger_id = document.getElementById("passenger_id").innerHTML;
// alert(passenger_id);
        
var passenger_gps_lat = document.getElementById("passenger_gps_lat").innerHTML;
// alert(passenger_gps_lat);
        
var passenger_gps_long = document.getElementById("passenger_gps_long").innerHTML;
// alert(passenger_gps_long);
        
$('<img src="https://maps.googleapis.com/maps/api/staticmap?center='+passenger_gps_lat+','+passenger_gps_long+'&zoom=16&size=300x300&maptype=roadmap&markers=color:blue%7Clabel:P%7C'+passenger_gps_lat+','+passenger_gps_long+'&key=AIzaSyDb1A29Jk9FtTZSiHDlfUPM9mHM42cAiRo">').load(function() {
    $("#passenger_on_map").empty();
    $(this).appendTo('#passenger_on_map');
});
        


var myAudio = document.getElementById("snd_hey_taxi");
myAudio.play();
});

}

});
}

function myTimer() {
    
getLocationUpdate();

}

</script>

    <!-- Switch -->
  <div id="toggle_online" class="switch">
    <label>
      Offline
      <input id="toggle_online_checkbox" type="checkbox">
      <span class="lever"></span>
      Online
    </label>
  </div>
    
    <br>
    
    <a onclick="localStorage.removeItem('loggedin');location.reload();" class="waves-effect waves-light btn red">Logout</a>
    
    <br>
    
</div>
    

    

<style>
    #journeyrequest_passenger_name {
        text-transform: uppercase;
    }    
</style>

<div id="view_taxi_journeyrequest" style="display:none; margin-top: 3px;">
    
<audio id="snd_hey_taxi" style="display:none;" src="http://250taxi.com/sounds/callcab.mp3"></audio>
    
    <div id="journeyrequest_passenger_cards" class="row">
        <div class="col s12 m6">
          <div class="card blue-grey darken-1">
            <div class="card-content white-text">
              <span class="card-title">Journey Request</span>
              <p><div id="journeyrequest_passenger_name"></div></p>
            </div>
            <div class="card-action">
              <a onclick="request_accept();" href="#">Accept</a>
              <a onclick="request_decline();" href="#">Decline</a>
            </div>
          </div>
        </div>
      </div>
    
    <style>
        #passenger_on_map img {
            width: 90%;
            margin-left: auto;
            margin-right: auto;
            border: 3px solid white;
        }
    </style>
    
    <div id="passenger_on_map"></div>
    
</div>
    
<script>
    function request_accept() {
       location.reload();
    }
    function request_decline() {

        $.get( "http://250taxi.com/db/partner/taxi_comlink_journey.php?task=decline&id_no="+id_no+"",  function( data ) {
            document.getElementById('view_taxi_journeyrequest').style.display = 'none';
            document.getElementById('view_taxi_waiting').style.display = 'block';
        });
    }
</script>

</body>
</html>